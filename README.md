# QDDモーター特性モデリングツール

## 概要

このアプリケーションは、QDD（Quasi-Direct Drive）モーターの性能特性を詳細に分析し、3Dグラフで視覚化するためのGUIツールです。

ユーザーはモーターの物理パラメータや動作条件を入力することで、広範な電流・回転数範囲におけるトルク、効率、出力パワー、内部温度などを高精度に計算できます。


## 主な機能

- **高精度な損失モデリング**:
    - **銅損**: モーターの内部温度上昇に応じて巻線抵抗を補正し、より現実に即した銅損を計算します。
    - **鉄損**: ヒステリシス損と渦電流損を個別にモデル化します。
    - **ドライバ損失**: ドライバのON抵抗による損失と固定損失を考慮します。
    - **ギア損失**: ギアボックスの効率に基づき、伝達損失を計算します。
- **熱モデルの統合**:
    - 全損失と熱抵抗からモーターの定常温度を反復計算で推定します。
    - 推定された温度は巻線抵抗の計算にフィードバックされ、分析精度を高めます。
- **詳細な性能分析**:
    - **電圧計算**: 巻線のインダクタンスを考慮し、高回転時に必要なバス電圧を正確に計算します。
    - **性能指標**: 入力パラメータに基づき、トルク、効率、出力パワー、必要電圧などを広範囲な動作領域でマッピングします。
    - **計算効率の向上**: 温度収束計算のアルゴリズムを改善し、分析全体の応答性を向上させました。
- **インタラクティブな視覚化**:
    - **3D特性マップ**: 電流と回転数を軸に、選択した性能指標（効率、トルクなど）を3Dサーフェスプロットで視覚化します。
    - **動作領域の可視化**: 指定したバス電圧で動作可能な範囲をグラフ上に明示します。
- **サマリーとデータ管理**:
    - **性能サマリー**: ピーク効率、最大出力、最大トルクに加え、電圧制限下での最大回転数や最大電流など、より詳細な性能指標を自動で算出し、GUI上に表示します。
    - **プリセット機能**: パラメータ設定をJSONファイルとして明確に保存・読込できます。ファイルダイアログは`.json`形式にフィルタリングされ、誤ったファイルの選択を防ぎます。
    - **データ出力**: 計算された性能サマリーをテキストファイルとして、3DグラフをPNG画像として保存できます。

## 動作要件

- **Python**: 3.11 以上
- **ライブラリ**:
    - `matplotlib >= 3.10.7`
    - `numpy >= 2.3.4`
    - `pydantic >= 2.12.3`
    - `pytest >= 8.4.2` (テスト実行時)
    - `tkinter` (Python標準ライブラリ)

## インストール

1.  このリポジトリをクローンまたはダウンロードします。
2.  ターミナルでプロジェクトのルートディレクトリに移動し、`pip` を使って依存ライブラリをインストールします。

    ```bash
    # プロジェクトのルートディレクトリで実行
    pip install .
    ```

## 使い方

プロジェクトのルートディレクトリで以下のコマンドを実行すると、GUIアプリケーションが起動します。

```bash
python run_app.py
```

起動後、左側のパネルでモーターのパラメータを調整し、「計算＆プロット」ボタンを押すと、分析が実行され、結果が右側のグラフに表示されます。

## テスト

テストを実行するには、まず `pytest` をインストールします。

```bash
pip install pytest
```

その後、プロジェクトのルートディレクトリで以下のコマンドを実行します。

```bash
pytest
```

## パラメータ一覧

GUIの左パネルから以下のパラメータを入力できます。

| カテゴリ | パラメータ名 | 説明 |
|:---|:---|:---|
| **モーター基本特性** | `KV値 [rpm/V]` | モーターの速度定数 |
| | `一相あたり抵抗 (25℃) [Ohm]` | 基準温度(25℃)での巻線抵抗 |
| | `一相あたりインダクタンス [H]` | 巻線のインダクタンス |
| | `極対数` | モーターの磁極のペア数 |
| | `配線方式` | `star` (スター結線) または `delta` (デルタ結線) |
| | `連続電流 [A]` | モーターが連続して流せる電流 |
| | `ピーク電流 [A]` | モーターが短時間流せる最大電流 |
| **熱モデル** | `周囲温度 [°C]` | モーターが置かれている環境の温度 |
| | `モーター熱抵抗 [°C/W]` | モーターから周囲への熱の伝わりにくさ |
| **鉄損モデル** | `ヒステリシス係数 [W/rpm]` | ヒステリシス損の係数 |
| | `渦電流係数 [W/rpm^2]` | 渦電流損の係数 |
| **ドライバ損失モデル** | `ドライバON抵抗 [Ohm]` | ドライバFETのON抵抗 |
| | `ドライバ固定損失 [W]` | 電流に依存しないドライバの固定損失 |
| **ギア損失モデル** | `減速比` | ギアボックスの減速比 |
| | `ギア効率` | ギアボックスの伝達効率 (0~1] |
| **動作条件** | `バス電圧 [V]` | システムの電源電圧 |

## ライセンス

このプロジェクトは GNU General Public License v2.0 の下で公開されています。詳細は `LICENSE` ファイルをご覧ください。